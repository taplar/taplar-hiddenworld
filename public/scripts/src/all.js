"use strict";var Core=function(e,n,l,t){function a(){var t=(e(n),e(".core-global-container",l.body)),a=e(".core-header",l.body),o=e(".core-overlay",l.body),u=e(".core-spinner",l.body),r={startScrollPosition:0,startScrollTime:0},i={hideCoreMenu:function(e,n){a.addClass("core-scroll-up"),r.startScrollPosition=e,r.startScrollTime=n},hideCoreMenuIfRatioIsTooLarge:function(){a.height()/n.innerHeight>=.2?a.addClass("core-hide"):a.removeClass("core-hide"),setTimeout(i.hideCoreMenuIfRatioIsTooLarge,250)},showCoreMenu:function(e,n){a.removeClass("core-scroll-up"),r.startScrollPosition=e,r.startScrollTime=n},toggleCoreMenuOnScroll:function(){var e=Date.now(),n=t.scrollTop();n>a.height()?n>r.startScrollPosition?i.hideCoreMenu(n,e):r.startScrollPosition-n>100&&i.showCoreMenu(n,e):i.showCoreMenu(n,e),t.one("scroll",i.toggleCoreMenuOnScroll)}},c={privateFunctions:i,privateVariables:r,hideSpinner:function(){return u.addClass("core-hide"),o.addClass("core-hide"),s},hideOverlay:function(){return o.addClass("core-hide"),s},initialize:function(){return i.toggleCoreMenuOnScroll(),i.hideCoreMenuIfRatioIsTooLarge(),delete s.initialize,s},showOverlay:function(){return o.removeClass("core-hide"),s},showSpinner:function(){return o.removeClass("core-hide"),u.removeClass("core-hide"),s}};return c}var s=void 0;return{getInstance:function(){return s||(s=a(),delete s.privateFunctions,delete s.privateVariables),s},getTestInstance:a}}(jQuery,window,document);Core.getInstance().initialize();var Hiddenworld=function(e,n,l,t){function a(){var n,t,a=e(".core-global-container",l.body),o=a.find(".core-header"),u=a.find(".core-content"),r=a.find(".core-overlay"),i=a.find(".core-spinner"),c=u.find(".welcome"),p={1:"Alzas",2:"Altal",3:"Bren",4:"Brune Isle",5:"Corollia",6:"Dolence Isle",7:"Elem",8:"Fel",9:"Feldar",10:"Fodros",11:"Komor",12:"Lucrien",13:"Luthien",14:"Mogorva",15:"Torvain",16:"Wastelands",17:"Zalta"},d={templates:{}},m={bindMainMenuAction:function(){o.find(".core-menu-link").on("touchend click",m.openMainMenu)},bindOverlayAction:function(){r.on("touchend click",m.closeOpenMenus)},bindSubMenuAction:function(){n=a.find(".dialog.main-menu, .dialog.sub-menu"),n.filter(".dialog.sub-menu").on("touchend click",".menu-option",m.processMenuOption)},buildAccessoriesResultMap:function(e){return e.reduce(function(e,n,l,t){return l=n.towns,0===l.indexOf("Located in ")&&(l=l.slice(11)),t=[{class:"level",numeric:"numeric",value:n.level},{class:"name",numeric:"",value:n.name},{class:"element",numeric:"",value:n.element},{class:"effect",numeric:"",value:n.effect.split(/[,][ ]?/).join("<br>")},{class:"location",numeric:"",value:l.split(/[,][ ]?/).join("<br>")}],e.push({properties:t}),e},[])},buildArmoursResultMap:function(e){return e.reduce(function(e,n,l,t){return l=n.towns,0===l.indexOf("Located in ")&&(l=l.slice(11)),t=[{class:"level",numeric:"numeric",value:n.level},{class:"name",numeric:"",value:n.name},{class:"element",numeric:"",value:n.element},{class:"absorb",numeric:"numeric",value:n.absorb},{class:"evade",numeric:"numeric",value:n.evade},{class:"location",numeric:"",value:l.split(", ").join("<br>")}],e.push({properties:t}),e},[])},buildDonationsResultMap:function(e){return e.reduce(function(e,n,l){return l=[{class:"level",numeric:"numeric",value:n.level},{class:"donation",numeric:"numeric",value:n.donation}],e.push({properties:l}),e},[])},buildMenuOptions:function(e){return e.map(function(e,n){return{value:n+1,label:e}})},buildMonstersResultMap:function(e,n){return e.reduce(function(e,l,t,a){return t=l.place?l.place:n,a=[{class:"level",numeric:"numeric",value:l.level},{class:"name",numeric:"",value:l.name},{class:"location",numeric:"",value:p[t]}],e.push({properties:a}),e},[])},buildPotionsResultMap:function(e){return e.reduce(function(e,n,l){return l=[{class:"level",numeric:"numeric",value:n.levelmin},{class:"name",numeric:"",value:n.name},{class:"levelmax",numeric:"numeric",value:n.levelmax},{class:"effect",numeric:"",value:n.effect}],e.push({properties:l}),e},[])},buildWeaponsResultMap:function(e){return e.reduce(function(e,n,l){return l=[{class:"level",numeric:"numeric",value:n.level},{class:"name",numeric:"",value:n.name},{class:"element",numeric:"",value:n.element},{class:"damage",numeric:"numeric",value:n.damage},{class:"location",numeric:"",value:n.towns.split(", ").join("<br>")}],e.push({properties:l}),e},[])},clearPreviousResults:function(){u.find(".result-container ").remove(),c.removeClass("core-hide")},closeOpenMenus:function(){i.hasClass("core-hide")&&(n.addClass("core-hide"),Core.getInstance().hideOverlay())},compileTemplates:function(){var n=e("script",l);n.filter(".template").each(function(e,n){return d.templates[n.id]=Handlebars.compile(n.innerHTML)}),n.detach()},createAccessorySubMenu:function(){var e=d.templates["submenu-template"]({subMenuType:"accessory",endpoint:"attributes",menuLabel:"Accessory Attribute",options:m.buildMenuOptions(["Absorb","Charisma","Constitution","Dexterity","Evade","Health","Hp Regen","Intelligence","Mana","Speed","Strength","Wisdom"])});a.append(e)},createCategorySubMenu:function(){var e=d.templates["submenu-template"]({subMenuType:"category",endpoint:"categories",menuLabel:"Category",options:m.buildMenuOptions(["Weapons","Armours","Accessories","Potions","Donations"])});a.append(e)},createLevelSubMenu:function(){for(var e=[],n=1;n<101;n++)e.push({value:n,label:(n<10?"0":"")+n});var l=d.templates["submenu-template"]({subMenuType:"level",endpoint:"levels",menuLabel:"Level Summary",options:e});a.append(l)},createMainMenu:function(){t=e(d.templates["main-menu-template"]({menus:[{submenu:"category-menu",label:"Category"},{submenu:"accessory-menu",label:"Accessory Attribute"},{submenu:"weapon-menu",label:"Weapon Type"},{submenu:"monster-menu",label:"Monster Location"},{submenu:"level-menu",label:"Level Summary"}]})),t.on("touchend click",".sub-menu a",m.openSubMenu),a.append(t)},createMonsterSubMenu:function(){var e=d.templates["submenu-template"]({subMenuType:"monster",endpoint:"towns",menuLabel:"Monster Location",options:m.buildMenuOptions(["Alzas","Altal","Bren","Brune","Corollia","Dolence Isle","Elem","Fel","Feldar","Fodros","Komor","Lucrien","Luthien","Mogorva","Torvain","Wastelands","Zalta"])});a.append(e)},createWeaponSubMenu:function(){var e=d.templates["submenu-template"]({subMenuType:"weapon",endpoint:"types",menuLabel:"Weapon Type",options:[{value:"4",label:"Axe"},{value:"2",label:"Blade"},{value:"10",label:"Bow"},{value:"7",label:"Club"},{value:"11",label:"Crossbow"},{value:"12",label:"Halberd"},{value:"8",label:"Hammer"},{value:"3",label:"Knife"},{value:"6",label:"Knuckle"},{value:"13",label:"Lance"},{value:"14",label:"Pike"},{value:"18",label:"Projectile"},{value:"17",label:"Scythe"},{value:"15",label:"Spear"},{value:"5",label:"Staff"},{value:"1",label:"Sword"}]});a.append(e)},displayAccessories:function(e){e=d.templates["results-template"]({resultType:"items",resultLabel:"Accessories",resultLabels:[{label:"Lv"},{label:"Name"},{label:"Element"},{label:"Effect"},{label:"Location"}],results:m.buildAccessoriesResultMap(e)}),u.append(e)},displayArmours:function(e){e=d.templates["results-template"]({resultType:"armours",resultLabel:"Armours",resultLabels:[{label:"Lv"},{label:"Name"},{label:"Element"},{label:"Absorb"},{label:"Evade<br>(%)"},{label:"Location"}],results:m.buildArmoursResultMap(e)}),u.append(e)},displayDonations:function(e){e=d.templates["results-template"]({resultType:"donations",resultLabel:"Donations",resultLabels:[{label:"Lv"},{label:"Amount"}],results:m.buildDonationsResultMap(e)}),u.append(e)},displayEndpoint:function(n,l){Core.getInstance().showSpinner(),e.ajax({url:"api/equipment/"+n,dataType:"json"}).then(function(e){return m.displayFilterResults(e,l)}).always(function(){return Core.getInstance().hideSpinner()})},displayFilterResults:function(e,n){c.addClass("core-hide"),e.donations&&m.displayDonations(e.donations),e.weapons&&m.displayWeapons(e.weapons),e.armours&&m.displayArmours(e.armours),e.accessories&&m.displayAccessories(e.accessories),e.potions&&m.displayPotions(e.potions),e.monsters&&m.displayMonsters(e.monsters,n)},displayMonsters:function(e,n){e=d.templates["results-template"]({resultType:"monsters",resultLabel:"Monsters",resultLabels:[{label:"Lv"},{label:"Name"},{label:"Location"}],results:m.buildMonstersResultMap(e,n)}),u.append(e)},displayPotions:function(e){e=d.templates["results-template"]({resultType:"potions",resultLabel:"Potions",resultLabels:[{label:"Lv"},{label:"Name"},{label:"Lv Max"},{label:"Effect"}],results:m.buildPotionsResultMap(e)}),u.append(e)},displayWeapons:function(e){e=d.templates["results-template"]({resultType:"weapons",resultLabel:"Weapons",resultLabels:[{label:"Lv"},{label:"Name"},{label:"Element"},{label:"Damage"},{label:"Location"}],results:m.buildWeaponsResultMap(e)}),u.append(e)},openMainMenu:function(e){e.preventDefault(),m.touchEventEndedOnSameElement(e)&&(m.clearPreviousResults(),m.closeOpenMenus(),Core.getInstance().showOverlay(),t.removeClass("core-hide"))},openSubMenu:function(l){l.preventDefault(),m.touchEventEndedOnSameElement(l)&&(m.closeOpenMenus(),Core.getInstance().showOverlay(),n.filter("."+e(this).data("submenu")).removeClass("core-hide"))},processMenuOption:function(n){if(n.preventDefault(),m.touchEventEndedOnSameElement(n)){m.closeOpenMenus();var t=e(this),a=t.closest(".sub-menu"),s=t.data("value"),o=a.data("endpoint")+"/"+s;m.displayEndpoint(o,s),history.pushState({endpoint:o,selectedValue:s},l.title,l.location.href)}},touchEventEndedOnSameElement:function(e){if(e.changedTouches){var n=e.changedTouches[0],t=l.elementFromPoint(n.clientX,n.clientY);return e.target===t}return!0}},b={privateFunctions:m,privateVariables:d,initialize:function(){var e=["compileTemplates","createMainMenu","createCategorySubMenu","createAccessorySubMenu","createWeaponSubMenu","createMonsterSubMenu","createLevelSubMenu","bindMainMenuAction","bindSubMenuAction","bindOverlayAction"];e.forEach(function(e){m[e](),delete m[e]}),delete s.initialize}};return b}var s=void 0;return{getInstance:function(){return s||(s=a(),delete s.privateFunctions,delete s.privateVariables),s},getTestInstance:a}}(jQuery,window,document);Hiddenworld.getInstance().initialize();